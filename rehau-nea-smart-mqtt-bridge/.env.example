# REHAU NEA SMART 2.0 MQTT Bridge Configuration
# Copy this file to .env and fill in your values

# ============================================
# REQUIRED CONFIGURATION
# ============================================

# REHAU Account Credentials
REHAU_EMAIL=your.email@example.com
REHAU_PASSWORD=your_password

# MQTT Broker Configuration
# For Docker Compose: use service name (e.g., "mqtt-broker")
# For standalone: use hostname or IP (e.g., "localhost" or "192.168.1.100")
MQTT_HOST=localhost
MQTT_PORT=1883

# MQTT Authentication (optional, leave empty if broker has no auth)
MQTT_USER=
MQTT_PASSWORD=

# ============================================
# OPTIONAL CONFIGURATION
# ============================================

# REST API & Web UI Configuration
# Set to 'false' to disable the REST API server
API_ENABLED=true

# Set to 'false' to disable the Web UI (if disabled, only API endpoints are available)
# Note: If WEB_UI_ENABLED=true, API_ENABLED will be automatically set to true
WEB_UI_ENABLED=true

# Set to 'false' to disable Swagger documentation (saves ~40MB memory)
# Swagger UI is accessible at /api-docs when enabled
SWAGGER_ENABLED=true

# REST API & Web UI Port (default: 3000)
API_PORT=3000

# API Authentication (default: admin/admin)
# Change these for production!
API_USERNAME=admin
API_PASSWORD=admin

# JWT Secret for token signing (generate a secure random string for production)
JWT_SECRET=your-secret-key-change-this-in-production

# Log Level: debug|info|warn|error (default: info)
LOG_LEVEL=info

# Show successful API requests (200 OK) in logs (default: false)
# Set to 'true' to see all API requests including successful ones
# Set to 'false' to hide 200 OK responses and reduce log noise
LOG_SHOW_OK_REQUESTS=false

# Zone Reload Interval in seconds (default: 300 = 5 minutes)
# How often to poll REHAU API for zone updates
# Range: 30-86400 seconds
ZONE_RELOAD_INTERVAL=300

# Token Refresh Interval in seconds (default: 21600 = 6 hours)
# How often to refresh REHAU authentication token
# Range: 1800-86400 seconds
TOKEN_REFRESH_INTERVAL=21600

# Referentials Reload Interval in seconds (default: 86400 = 24 hours)
# How often to reload referential data from REHAU
# Range: 3600-604800 seconds
REFERENTIALS_RELOAD_INTERVAL=86400

# Use Group in Names (default: false)
# If true, includes group name in entity display names
USE_GROUP_IN_NAMES=false

# Live Data Polling Interval in seconds (default: 300 = 5 minutes)
# How often to request LIVE data from REHAU installations
LIVE_DATA_INTERVAL=300

# Command Retry Configuration (optional)
# Timeout for command retries in seconds (default: 30)
COMMAND_RETRY_TIMEOUT=30
# Maximum number of retries for failed commands (default: 3)
COMMAND_MAX_RETRIES=3


# POP3 Configuration for REHAU Account (if you go for gmx.com, remember to enable POP3/IMAP in your account settings)
# POP3 Provider: basic | gmail | outlook
POP3_PROVIDER=basic

# Basic Authentication (for GMX, custom servers, etc.)
POP3_EMAIL=you.email@gmx.com
POP3_PASSWORD=YourPassword
POP3_HOST=pop.gmx.com
POP3_PORT=995
POP3_SECURE=true
POP3_DEBUG=true
POP3_TIMEOUT=600000
POP3_FROM_ADDRESS=noreply@accounts.rehau.com
# Set to 'false' to enforce strict TLS certificate validation (default: true, ignores TLS errors)
POP3_IGNORE_TLS_ERRORS=true

# OAuth2 Configuration (for Gmail/Outlook)
# Only required if POP3_PROVIDER=gmail or POP3_PROVIDER=outlook
# See docs/oauth2-setup.md for setup instructions
POP3_OAUTH2_CLIENT_ID=
POP3_OAUTH2_CLIENT_SECRET=
POP3_OAUTH2_REFRESH_TOKEN=
# For Outlook only (optional, defaults to 'common')
POP3_OAUTH2_TENANT_ID=common

# Testing/Debugging Options
# Force token to appear expired to trigger reauthentication (for testing)
# FORCE_TOKEN_EXPIRED=true

# Simulate disconnection/reauthentication after X seconds from first successful login (for testing)
# Useful for testing the second authentication flow without waiting for natural token expiry
# SIMULATE_DISCONNECT_AFTER_SECONDS=60

# Playwright Browser Configuration
# Set to 'false' to see the browser during authentication (useful for debugging)
# Set to 'true' for headless mode in production (default: true)
PLAYWRIGHT_HEADLESS=false

# Playwright Idle Timeout in seconds (default: 300 = 5 minutes)
# Browser will automatically close after this period of inactivity
# Set to 0 to disable idle timeout
PLAYWRIGHT_IDLE_TIMEOUT=300

# Monitoring Configuration
# Memory warning threshold in MB (default: 250)
# Warns when heap memory usage exceeds this value
# Note: 200-300MB is normal for this application with API, Web UI, and Playwright
MEMORY_WARNING_MB=250

# Staleness Detection Configuration
# Warning threshold in milliseconds (default: 600000 = 10 minutes)
# Logs warning when zone data hasn't been updated for this long
STALENESS_WARNING_MS=600000

# Stale threshold in milliseconds (default: 1800000 = 30 minutes)
# Triggers auto-refresh when zone data hasn't been updated for this long
STALENESS_STALE_MS=1800000

# Token Refresh Strategy
# Set to 'true' to always perform fresh login (old behavior, slower but more reliable)
# Set to 'false' or leave unset to use token refresh when possible (default: false, faster)
# FORCE_FRESH_LOGIN=false

# Command Optimization
# Set to 'true' to skip sending commands to REHAU that wouldn't change the current state
# This reduces unnecessary traffic and prevents command timeouts on redundant commands
# Set to 'false' or leave unset to always send commands (default: false)
# DISABLE_REDUNDANT_COMMANDS=true